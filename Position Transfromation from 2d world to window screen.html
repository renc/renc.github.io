<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Position Transfromation from 2d world to window screen</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">阿can's  blog </a></h1>
                <nav><ul>
                    <li><a href="/pages/about_page.html">About</a></li>
                    <li><a href="/category/.html"></a></li>
                    <li class="active"><a href="/category/computer-graphics.html">Computer Graphics</a></li>
                    <li><a href="/category/programming.html">programming</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/Position Transfromation from 2d world to window screen.html" rel="bookmark"
           title="Permalink to Position Transfromation from 2d world to window screen">Position Transfromation from 2d world to window screen</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-06-19T10:20:00">
                Published: 周四 19 六月 2014
        </abbr>
		<br />
        <abbr class="modified" title="2014-06-19T19:30:00">
                Updated: 周四 19 六月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/.html"></a>
        </address>
<p>In <a href="/category/computer-graphics.html">computer graphics</a>. </p>
<p>tags: <a href="/tag/.html"></a> </p>
</footer><!-- /.post-info -->      <p>工作中遇到一个问题, 坐标映射。A 2d world is rendering in a window, user can mouse click on the window, how to find the position at 2d world corresponding to this mouse positon?     </p>
<h2>Background背景</h2>
<p>工作中遇到一个问题, 坐标映射。A 2d world is rendering in a window, user can mouse click on the window, how to find the position at 2d world corresponding to this mouse positon?</p>
<h2>Transform变换和映射</h2>
<p>解法Solution直接看我自己画的图片: 
<img alt="Alt text" src="data/2014-06-20-ViewToPort.png" title="output" />
Note 1:图中的变换矩阵其实是从2d world映射到window坐标的。假如再求invert, 就可以得到逆变换, 从window坐标到2d world坐标了。推导的过程有些烦, 数学不好, 但是结果很美好:-) 
Note 2:图中例子是用横向量的, v*M=v_new; 要对应到竖向量的话请把M翻转一下.</p>
<h2>Ortho Projection</h2>
<p>上面只是单纯从几何来看，那原本的问题中还涉及渲染呢. 那问题就来了, 那个2d world是怎么被渲染成window窗口里面的呢? </p>
<p>首先图片中的view=2d world, 是有大小和朝向的, (left, bottom) -&gt; (right, top). width = right - left. 
好奇去看看opengl的函数，发现Ortho project也需要这几个参数, 会不会有什么联系呢?
当把图中的矩阵M3的w拆开为right, left, 又刚刚好等于ortho projection matrix( 这个矩阵在书上网上代码上都很容易找到的)。</p>
<p>那是不是可以把上面的Transfrom 1/2/3理解为跟OpengGL里面ortho projection类似呢? 我觉得像哦.</p>
<p>也就是要渲染一个2d的世界, 在模型在世界坐标排好了之后, 给出我们想要渲染出来的l/b/r/t, 通过ortho projection, 就可以把那一块区域渲染到窗口上了? 这里好像没有涉及model and camera transform喔, 也就是modelViewMatrix = identity. </p>
<h2>Pan and Zoom</h2>
<p>怎么在上一节的基础上加入pan and zoom的效果? 一般对于perspective projection来说, 会引入camera, 通过改变camera的position and target point可以实现pan平移, 移动camera来靠近和远离target point, 也达到了zoom in/out的效果. 而对于上一节中我们说到的从view to port的例子中, 貌似直接更改(left, bottom, right, top)就ok了.
例如pan: 
右移: left = left + deltaX, right = right + deltaX;
上移: bottom = bottom + deltaY, top = top + deltaY;</p>
<p>缩放zoom in/out就复杂一些: 
<img alt="Alt text" src="data/2014-06-20-ortho_zoom.png" title="output" /></p>
<p>折腾一个小demo: 
<img alt="Alt text" src="data/2014-06-20-transform_orthoProj.gif" title="output" />    <br />
source code:  </p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="https://github.com/renc">Github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>