<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>texFormat的一次bugFix - 阿can's blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/texFormat的一次bugFix.html">

        <meta name="author" content="renc" />
        <meta name="description" content="故事的开头是有个bug说map extraction的ptex文件file1, 在import as paint layer and export paint layer again之后文件file2的大小相差几倍，怀疑file1跟file2中pixel的value不一样了。 file1.ptex vs. file2.ptex 用ptex代码附带的ptexInfo程序把ptex file的data dump出来, 默认是dump all faces, all levels, 发现数据量太大了。 需要ptexInfo做些修改, 只把个别感兴趣的face的数据输出. 花时间看ptex代码， ptex所调用的zlib可以把压缩关了, 另外ptex还可以关了generate mipmap， 这样ptex写出的数据应该就是没有压缩的而且只有level0的. 所谓的level0就是full resolution. 发现虽然file1.f0, file1.f0, 两者的resolution, pixel size都是一样的, 但是pixel value还是不一样, file1.f0的每一个pixel的RGBA value每一个channel都相对小了0.003左右. 继续追踪, 发现ptex ..." />

        <meta property="og:site_name" content="阿can's blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="texFormat的一次bugFix"/>
        <meta property="og:url" content="/texFormat的一次bugFix.html"/>
        <meta property="og:description" content="故事的开头是有个bug说map extraction的ptex文件file1, 在import as paint layer and export paint layer again之后文件file2的大小相差几倍，怀疑file1跟file2中pixel的value不一样了。 file1.ptex vs. file2.ptex 用ptex代码附带的ptexInfo程序把ptex file的data dump出来, 默认是dump all faces, all levels, 发现数据量太大了。 需要ptexInfo做些修改, 只把个别感兴趣的face的数据输出. 花时间看ptex代码， ptex所调用的zlib可以把压缩关了, 另外ptex还可以关了generate mipmap， 这样ptex写出的数据应该就是没有压缩的而且只有level0的. 所谓的level0就是full resolution. 发现虽然file1.f0, file1.f0, 两者的resolution, pixel size都是一样的, 但是pixel value还是不一样, file1.f0的每一个pixel的RGBA value每一个channel都相对小了0.003左右. 继续追踪, 发现ptex ..."/>
        <meta property="article:published_time" content="2015-08-13" />
            <meta property="article:section" content="tech" />
            <meta property="article:author" content="renc" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>


</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">
阿can's blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="/category/computer-graphics.html">Computer graphics</a>
                        </li>
                        <li >
                            <a href="/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="/category/programming.html">Programming</a>
                        </li>
                        <li class="active">
                            <a href="/category/tech.html">Tech</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/texFormat的一次bugFix.html"
                       rel="bookmark"
                       title="Permalink to texFormat的一次bugFix">
                        texFormat的一次bugFix
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-08-13T20:20:00+08:00"> 周四 13 八月 2015</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>故事的开头是有个bug说map extraction的ptex文件file1, 在import as paint layer and export paint layer again之后文件file2的大小相差几倍，怀疑file1跟file2中pixel的value不一样了。           <br />
file1.ptex  vs. file2.ptex                                         </p>
<p>用ptex代码附带的ptexInfo程序把ptex file的data dump出来, 默认是dump all faces, all levels, 发现数据量太大了。 需要ptexInfo做些修改, 只把个别感兴趣的face的数据输出.    <br />
花时间看ptex代码， ptex所调用的zlib可以把压缩关了, 另外ptex还可以关了generate mipmap， 这样ptex写出的数据应该就是没有压缩的而且只有level0的. 所谓的level0就是full resolution.       </p>
<p>发现虽然file1.f0, file1.f0, 两者的resolution, pixel size都是一样的, 但是pixel value还是不一样, file1.f0的每一个pixel的RGBA value每一个channel都相对小了0.003左右.                               </p>
<p>继续追踪, 发现ptex import as layer之后pixel value还是一样的, 而是后面的某个操作中把layer的texture从GPU放到CPU, 然后再从CPU到GPU时候pixel却不一样了. 最后发现是默认建texture的函数glTexImage2D用的是32 internal format, 而后面从CPU到GPU那时候建texture调用glTexImage2D竟然用了16 internal format.                  </p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="#"><i class="fa fa-you-can-add-links-in-your-config-file-square fa-lg"></i> You can add links in your config file</a></li>
                <li class="list-group-item"><a href="#"><i class="fa fa-another-social-link-square fa-lg"></i> Another social link</a></li>
              </ul>
            </li>



            <li class="list-group-item"><a href="/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                </ul>
            </li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
        <li class="list-group-item">
            <a href="#" target="_blank">
                You can modify those links in your config file
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 renc
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>


</body>
</html>